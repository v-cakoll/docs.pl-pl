---
title: Implementowanie Menedżera zasobów
description: Implementowanie Menedżera zasobów w programie .NET. Menedżer zasobów zarządza zasobami używanymi w transakcjach. Menedżer transakcji koordynuje akcje Menedżera zasobów.
ms.date: 03/30/2017
ms.assetid: d5c153f6-4419-49e3-a5f1-a50ae4c81bf3
ms.openlocfilehash: bf40c6eaee35a5a548c6de4a286e46c4d4a66aca
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141852"
---
# <a name="implementing-a-resource-manager"></a><span data-ttu-id="5f92e-105">Implementowanie Menedżera zasobów</span><span class="sxs-lookup"><span data-stu-id="5f92e-105">Implementing a Resource Manager</span></span>
<span data-ttu-id="5f92e-106">Poszczególne zasoby używane w transakcji jest zarządzane przez Menedżera zasobów, których działania są koordynowany przez Menedżera transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-106">Each resource used in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="5f92e-107">Menedżerowie zasobów pracują we współpracy z menedżerem transakcji w celu zapewnienia aplikacji z gwarancją niepodzielności i izolacji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-107">Resource managers work in cooperation with the transaction manager to provide the application with a guarantee of atomicity and isolation.</span></span> <span data-ttu-id="5f92e-108">Microsoft SQL Server, trwałe kolejki komunikatów, tabele skrótów w pamięci to wszystkie przykłady menedżerów zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-108">Microsoft SQL Server, durable message queues, in-memory hash tables are all examples of resource managers.</span></span>  
  
 <span data-ttu-id="5f92e-109">Menedżer zasobów zarządza trwałe lub nietrwała danych.</span><span class="sxs-lookup"><span data-stu-id="5f92e-109">A resource manager manages either durable or volatile data.</span></span> <span data-ttu-id="5f92e-110">Trwałość (lub odwrotnie niestabilności ich) zasobu menedżera odwołuje się do tego, czy Menedżera zasobów obsługuje odzyskiwanie po awarii.</span><span class="sxs-lookup"><span data-stu-id="5f92e-110">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="5f92e-111">Jeśli Menedżera zasobów obsługuje odzyskiwanie po awarii, utrzymuje danych do trwałego magazynu podczas fazy 1. (przygotowanie) tak, aby w przypadku awarii Menedżera zasobów, można ponownie zarejestrować transakcji po odzyskiwania i wykonać odpowiednie akcje w oparciu o powiadomienia otrzymane z menedżerem transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-111">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the transaction manager.</span></span> <span data-ttu-id="5f92e-112">Ogólnie rzecz biorąc Menedżerowie zasobów lotnych zarządzają zasobami nietrwałymi, takimi jak struktura danych w pamięci (na przykład w pamięci podręcznej), a trwałe Menedżerowie zasobów zarządzają zasobami, które mają bardziej trwały magazyn zapasowy (na przykład baza danych, której magazyn zapasowy jest dyskiem).</span><span class="sxs-lookup"><span data-stu-id="5f92e-112">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>  
  
 <span data-ttu-id="5f92e-113">Aby zasób, aby uczestniczyć w transakcji należy zarejestrować w transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-113">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="5f92e-114"><xref:System.Transactions.Transaction>Klasa definiuje zestaw metod, których nazwy zaczynają się od **rejestracji** , która zapewnia tę funkcję.</span><span class="sxs-lookup"><span data-stu-id="5f92e-114">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="5f92e-115">Różne metody **rejestracji** odnoszą się do różnych typów rejestracji, które może mieć Menedżer zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-115">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="5f92e-116">W szczególności użyj <xref:System.Transactions.Transaction.EnlistVolatile%2A> metody dla lotnych zasoby i <xref:System.Transactions.Transaction.EnlistDurable%2A> metody dla trwałego zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-116">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="5f92e-117">Aby zapewnić prostotę, po podjęciu decyzji o tym, czy użyć <xref:System.Transactions.Transaction.EnlistDurable%2A> <xref:System.Transactions.Transaction.EnlistVolatile%2A> metody lub w oparciu o wsparcie trwałości zasobu, należy zarejestrować zasób do wzięcia udziału w dwóch fazach zatwierdzania (2PC) przez implementację <xref:System.Transactions.IEnlistmentNotification> interfejsu dla Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="5f92e-118">Aby uzyskać więcej informacji na temat 2PC, zobacz temat [zatwierdzanie transakcji w ramach jednej fazy i wielofazowej](committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="5f92e-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>  
  
 <span data-ttu-id="5f92e-119">Przez wywołanie tej metody, Menedżer zasobów zapewnia ona pobiera wywołania zwrotne z menedżerem transakcji po zatwierdzeniu lub przerwaniu transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-119">By enlisting, the resource manager ensures that it gets callbacks from the transaction manager when the transaction commits or aborts.</span></span> <span data-ttu-id="5f92e-120">Istnieje jedno wystąpienie <xref:System.Transactions.IEnlistmentNotification> na rejestracji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-120">There is one instance of <xref:System.Transactions.IEnlistmentNotification> per enlistment.</span></span> <span data-ttu-id="5f92e-121">Zwykle istnieje jedna Rejestracja na transakcję, ale Menedżer zasobów może wybrać wiele razy w tej samej transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-121">Typically, there is one enlistment per transaction, but a resource manager can choose to enlist multiple times in the same transaction.</span></span>  
  
 <span data-ttu-id="5f92e-122">Po rejestracji Menedżera zasobów odpowiada na żądania transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-122">After enlistment, the resource manager responds to the transaction's requests.</span></span> <span data-ttu-id="5f92e-123">Menedżer zasobów trwałe przechowuje wystarczających informacji do pozwalać na jego cofnąć lub ponowić transakcji pracy zasobów, że zarządza.</span><span class="sxs-lookup"><span data-stu-id="5f92e-123">A durable resource manager stores enough information to allow it to either undo or redo the transaction's work on resources it manages.</span></span> <span data-ttu-id="5f92e-124">Istnieje wiele sposobów, w tym; przechowywanie wersji danych lub utrzymywanie dziennika zmian są dwie metody wspólne.</span><span class="sxs-lookup"><span data-stu-id="5f92e-124">There are many ways to do this; keeping versions of data or keeping a log of the changes are two common techniques.</span></span>  
  
 <span data-ttu-id="5f92e-125">Gdy aplikacja zatwierdzi transakcję, Menedżer transakcji inicjuje dwufazowego protokołu zatwierdzania.</span><span class="sxs-lookup"><span data-stu-id="5f92e-125">When the application commits the transaction, the transaction manager initiates the two-phase commit protocol.</span></span> <span data-ttu-id="5f92e-126">Menedżer transakcji najpierw pyta, czy każdy Menedżera zasobów Jeśli jest gotowa do zatwierdzania transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-126">The transaction manager first asks each enlisted resource manager if it is prepared to commit the transaction.</span></span> <span data-ttu-id="5f92e-127">Menedżer zasobów musi przygotowania do zatwierdzenia — jej przygotowuje się do zatwierdzenia lub przerwania transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-127">The resource manager must prepare to commit—it readies itself to either commit or abort the transaction.</span></span>  
  
 <span data-ttu-id="5f92e-128">W fazie przygotowanie Menedżera zasobów trwałe rejestruje stara i Nowa danych w magazynie stabilna, dzięki czemu Menedżera zasobów można go odzyskać nawet w przypadku awarii systemu.</span><span class="sxs-lookup"><span data-stu-id="5f92e-128">During the prepare phase, the durable resource manager records the old and new data in stable storage so that the resource manager can recover it even if the system fails.</span></span> <span data-ttu-id="5f92e-129">Jeśli Menedżera zasobów można przygotować, informuje menedżera transakcji jego głos na zatwierdzenia lub przerwania transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-129">If the resource manager can prepare, it informs the transaction manager its vote on whether to commit or abort the transaction.</span></span> <span data-ttu-id="5f92e-130">Jeśli którykolwiek z menedżerów zasobów zgłosi błąd przygotowania, Menedżer transakcji wysyła polecenie wycofania do każdego Menedżera zasobów i wskazuje niepowodzenie zatwierdzenia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-130">If any resource manager reports a failure to prepare, the transaction manager sends a rollback command to each resource manager and indicates the failure of the commit to the application.</span></span>  
  
 <span data-ttu-id="5f92e-131">Po przygotowaniu Menedżera zasobów musi czekać, aż otrzyma zatwierdzania lub przerwania wywołania zwrotnego z menedżerem transakcji w fazie 2.</span><span class="sxs-lookup"><span data-stu-id="5f92e-131">Once prepared, a resource manager must wait until it gets a commit or abort callback from the transaction manager in phase 2.</span></span> <span data-ttu-id="5f92e-132">Zwykle cały protokół przygotowywania i zatwierdzania kończy się w części sekundy.</span><span class="sxs-lookup"><span data-stu-id="5f92e-132">Typically, the entire prepare and commit protocol completes in a fraction of a second.</span></span> <span data-ttu-id="5f92e-133">Jeśli występują awarie systemu lub łączności, zatwierdzania lub przerwania powiadomień nie może pojawić się dla minuty lub godziny.</span><span class="sxs-lookup"><span data-stu-id="5f92e-133">If there are system or communication failures, the commit or abort notification may not arrive for minutes or hours.</span></span> <span data-ttu-id="5f92e-134">W tym okresie Menedżera zasobów jest w stanie wątPLiwości wyniku transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-134">During this period, the resource manager is in doubt about the outcome of the transaction.</span></span> <span data-ttu-id="5f92e-135">Nie wiedzieć, czy zatwierdzeniu lub przerwaniu transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-135">It does not know whether the transaction committed or aborted.</span></span> <span data-ttu-id="5f92e-136">Menedżer zasobów jest w stanie wątPLiwości transakcji, zapewnia dane zmodyfikowany przez utrzymywanie transakcji zablokowane, a tym samym izolowanie te zmiany innych transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-136">While the resource manager is in doubt about a transaction, it keeps the data modified by keeping the transaction locked, thereby isolating these changes from any other transactions.</span></span>  
  
 <span data-ttu-id="5f92e-137">Gdy Menedżer zasobów nie powiodło się, wszystkich jej znajdujących się w wykazie transakcji zostało przerwane z wyjątkiem tych, które zostały przygotowane lub zadeklarowane przed awarii.</span><span class="sxs-lookup"><span data-stu-id="5f92e-137">When a resource manager fails, all of its enlisted transactions are aborted except for those that are prepared or committed prior to the failure.</span></span> <span data-ttu-id="5f92e-138">Po ponownym uruchomieniu Menedżera zasobów trwałe rekonstruuje zatwierdzone stanu zasobów, którymi zarządza pobierając prepare informacje zapisane w fazie przygotowania i zatwierdzane lub przerywa daną transakcję.</span><span class="sxs-lookup"><span data-stu-id="5f92e-138">When a durable resource manager restarts, it reconstructs the committed state of the resources it manages by retrieving the prepare information written in the prepare phase, and commits or aborts these transactions accordingly.</span></span>  
  
 <span data-ttu-id="5f92e-139">Podsumowanie Protokół dwufazowego i menedżerów zasobów połączyć wykonywanie transakcji częściowych i trwałe.</span><span class="sxs-lookup"><span data-stu-id="5f92e-139">In summary, the two-phase commit protocol and the resource managers combine to make transactions atomic and durable.</span></span>  
  
 <span data-ttu-id="5f92e-140"><xref:System.Transactions.Transaction> Klasa udostępnia także <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> metodę, aby zarejestrować awansowanie jednego etapu rejestracji (PSPE).</span><span class="sxs-lookup"><span data-stu-id="5f92e-140">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="5f92e-141">Dzięki temu trwałe zasobu manager (MB), hosta i "własnością" transakcji, która może zostać później przekazany do były zarządzane przez MSDTC, jeśli to konieczne.</span><span class="sxs-lookup"><span data-stu-id="5f92e-141">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="5f92e-142">Aby uzyskać więcej informacji na ten temat, zobacz [Optymalizacja przy użyciu jednej fazy zatwierdzania i powiadomienia o pojedynczej fazie](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="5f92e-142">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="5f92e-143">W tej sekcji</span><span class="sxs-lookup"><span data-stu-id="5f92e-143">In This Section</span></span>  
 <span data-ttu-id="5f92e-144">W następujących tematach opisano kroki zwykle następuje Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-144">The steps generally followed by a resource manager are outlined in the following topics.</span></span>  
  
 [<span data-ttu-id="5f92e-145">Rejestrowanie zasobów jako uczestników transakcji</span><span class="sxs-lookup"><span data-stu-id="5f92e-145">Enlisting Resources as Participants in a Transaction</span></span>](enlisting-resources-as-participants-in-a-transaction.md)  
  
 <span data-ttu-id="5f92e-146">Opisuje, jak trwałe zasobu można zarejestrować w transakcji.</span><span class="sxs-lookup"><span data-stu-id="5f92e-146">Describes how a durable or volatile resource can enlist in a transaction.</span></span>  
  
 [<span data-ttu-id="5f92e-147">Zatwierdzanie transakcji jednofazowe i wielofazowe</span><span class="sxs-lookup"><span data-stu-id="5f92e-147">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)  
  
 <span data-ttu-id="5f92e-148">Opisuje, jak Zatwierdź powiadomień i przygotowania zatwierdzanie z użytkownikiem odpowiada Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-148">Describes how a resource manager responds to commit notification and prepare the commit.</span></span>  
  
 [<span data-ttu-id="5f92e-149">Odzyskiwanie systemu</span><span class="sxs-lookup"><span data-stu-id="5f92e-149">Performing Recovery</span></span>](performing-recovery.md)  
  
 <span data-ttu-id="5f92e-150">Opisuje sposób trwałego menedżerem przywraca po awarii.</span><span class="sxs-lookup"><span data-stu-id="5f92e-150">Describes how a durable resource manager recovers from failure.</span></span>  
  
 [<span data-ttu-id="5f92e-151">Poziomy zaufania zabezpieczeń podczas uzyskiwania dostępu do zasobów</span><span class="sxs-lookup"><span data-stu-id="5f92e-151">Security Trust Levels in Accessing Resources</span></span>](security-trust-levels-in-accessing-resources.md)  
  
 <span data-ttu-id="5f92e-152">Opisuje sposób trzy poziomy zaufania System.Transactions ograniczyć dostęp dla typów zasobów, które <xref:System.Transactions> przedstawia.</span><span class="sxs-lookup"><span data-stu-id="5f92e-152">Describes how the three levels of trust for System.Transactions restrict access on the types of resources that <xref:System.Transactions> exposes.</span></span>  
  
 [<span data-ttu-id="5f92e-153">Optymalizacja za pomocą zatwierdzania jednofazowego i umożliwiającego awansowanie powiadomienia jednofazowego</span><span class="sxs-lookup"><span data-stu-id="5f92e-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)  
  
 <span data-ttu-id="5f92e-154">Opisuje praktyki optymalizacji dostępne dla implementacji menedżerów zasobów.</span><span class="sxs-lookup"><span data-stu-id="5f92e-154">Describes optimization practices available to implementations of resource managers.</span></span>
