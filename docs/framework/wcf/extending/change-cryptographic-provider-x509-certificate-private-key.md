---
title: 'Instrukcje: zmienianie dostawcy kryptograficznego dla klucza prywatnego certyfikatu X.509'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
ms.openlocfilehash: 8101c0d1214eed2c6ea42a4faab774207aab3a79
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/07/2019
ms.locfileid: "70797279"
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificates-private-key"></a><span data-ttu-id="91873-102">Instrukcje: zmienianie dostawcy kryptograficznego dla klucza prywatnego certyfikatu X.509</span><span class="sxs-lookup"><span data-stu-id="91873-102">How to: Change the Cryptographic Provider for an X.509 Certificate's Private Key</span></span>
<span data-ttu-id="91873-103">W tym temacie pokazano, jak zmienić dostawcę usług kryptograficznych używany do udostępniania klucza prywatnego certyfikatu X. 509 oraz jak zintegrować dostawcę z platformą zabezpieczeń Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="91873-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the Windows Communication Foundation (WCF) security framework.</span></span> <span data-ttu-id="91873-104">Aby uzyskać więcej informacji o korzystaniu z certyfikatów, zobacz [Praca z certyfikatami](../feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="91873-104">For more information about using certificates, see [Working with Certificates](../feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="91873-105">Struktura zabezpieczeń WCF umożliwia wprowadzenie nowych typów tokenów zabezpieczających, zgodnie z opisem w [temacie How to: Utwórz token](how-to-create-a-custom-token.md)niestandardowy.</span><span class="sxs-lookup"><span data-stu-id="91873-105">The WCF security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="91873-106">Istnieje również możliwość użycia tokenu niestandardowego do zastępowania istniejących typów tokenów dostarczonych przez system.</span><span class="sxs-lookup"><span data-stu-id="91873-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="91873-107">W tym temacie, dostarczony przez system token zabezpieczający X. 509 jest zastępowany przez niestandardowy token X. 509, który zapewnia inną implementację klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="91873-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="91873-108">Jest to przydatne w scenariuszach, w których rzeczywisty klucz prywatny jest udostępniany przez innego dostawcę usług kryptograficznych niż domyślny dostawca usług kryptograficznych systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="91873-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="91873-109">Przykładem alternatywnego dostawcy usług kryptograficznych jest sprzętowy moduł zabezpieczeń, który wykonuje wszystkie operacje kryptograficzne związane z kluczem prywatnym i nie przechowuje kluczy prywatnych w pamięci, dzięki czemu można poprawić bezpieczeństwo systemu.</span><span class="sxs-lookup"><span data-stu-id="91873-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="91873-110">Poniższy przykład jest przeznaczony wyłącznie do celów demonstracyjnych.</span><span class="sxs-lookup"><span data-stu-id="91873-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="91873-111">Nie zastępuje domyślnego dostawcy usług kryptograficznych systemu Windows, ale pokazuje, gdzie można zintegrować ten dostawca.</span><span class="sxs-lookup"><span data-stu-id="91873-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="91873-112">Procedury</span><span class="sxs-lookup"><span data-stu-id="91873-112">Procedures</span></span>  
 <span data-ttu-id="91873-113">Każdy token zabezpieczający, który ma skojarzony klucz zabezpieczeń lub klucze, musi implementować <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> właściwość, która zwraca kolekcję kluczy z wystąpienia tokenu zabezpieczającego.</span><span class="sxs-lookup"><span data-stu-id="91873-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="91873-114">Jeśli token jest tokenem zabezpieczającym X. 509, kolekcja zawiera pojedyncze wystąpienie <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> klasy, które reprezentuje klucze publiczne i prywatne skojarzone z certyfikatem.</span><span class="sxs-lookup"><span data-stu-id="91873-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="91873-115">Aby zastąpić domyślnego dostawcę usług kryptograficznych używanego do dostarczania kluczy certyfikatu, Utwórz nową implementację tej klasy.</span><span class="sxs-lookup"><span data-stu-id="91873-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="91873-116">Aby utworzyć niestandardowy klucz asymetryczny X. 509</span><span class="sxs-lookup"><span data-stu-id="91873-116">To create a custom X.509 asymmetric key</span></span>  
  
1. <span data-ttu-id="91873-117">Zdefiniuj nową klasę pochodną <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> klasy.</span><span class="sxs-lookup"><span data-stu-id="91873-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2. <span data-ttu-id="91873-118">Zastąp <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> właściwość tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="91873-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="91873-119">Ta właściwość zwraca rzeczywisty rozmiar klucza pary kluczy publicznych/prywatnych certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="91873-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3. <span data-ttu-id="91873-120">Zastąp <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91873-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="91873-121">Ta metoda jest wywoływana przez strukturę zabezpieczeń WCF w celu odszyfrowania klucza symetrycznego za pomocą klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="91873-121">This method is called by the WCF security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="91873-122">(Klucz został wcześniej zaszyfrowany przy użyciu klucza publicznego certyfikatu).</span><span class="sxs-lookup"><span data-stu-id="91873-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4. <span data-ttu-id="91873-123">Zastąp <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91873-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="91873-124">Ta metoda jest wywoływana przez strukturę zabezpieczeń WCF w celu uzyskania wystąpienia <xref:System.Security.Cryptography.AsymmetricAlgorithm> klasy, która reprezentuje dostawcę usług kryptograficznych dla klucza prywatnego lub publicznego certyfikatu, w zależności od parametrów przekazywania do metody.</span><span class="sxs-lookup"><span data-stu-id="91873-124">This method is called by the WCF security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5. <span data-ttu-id="91873-125">Opcjonalny.</span><span class="sxs-lookup"><span data-stu-id="91873-125">Optional.</span></span> <span data-ttu-id="91873-126">Zastąp <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91873-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="91873-127">Zastąp tę metodę, jeśli wymagana jest inna <xref:System.Security.Cryptography.HashAlgorithm> implementacja klasy.</span><span class="sxs-lookup"><span data-stu-id="91873-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6. <span data-ttu-id="91873-128">Zastąp <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91873-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="91873-129">Ta metoda zwraca wystąpienie <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> klasy skojarzonej z kluczem prywatnym certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="91873-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7. <span data-ttu-id="91873-130">Zastąp <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91873-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="91873-131">Ta metoda służy do wskazywania, czy określony algorytm kryptograficzny jest obsługiwany przez implementację klucza zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="91873-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="91873-132">Poniższa procedura pokazuje, jak zintegrować niestandardową implementację klucza zabezpieczeń X. 509 utworzoną w poprzedniej procedurze z platformą zabezpieczeń WCF w celu zastąpienia dostarczonego przez system tokenu zabezpieczającego X. 509.</span><span class="sxs-lookup"><span data-stu-id="91873-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the WCF security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="91873-133">Aby zamienić określony przez system token zabezpieczający X. 509 z niestandardowym tokenem klucza zabezpieczeń X. 509</span><span class="sxs-lookup"><span data-stu-id="91873-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1. <span data-ttu-id="91873-134">Utwórz niestandardowy token zabezpieczający X. 509, który zwraca niestandardowy klucz zabezpieczeń X. 509, a nie klucz zabezpieczeń dostarczony przez system, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="91873-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="91873-135">Aby uzyskać więcej informacji na temat niestandardowych tokenów [zabezpieczających, zobacz How to: Utwórz token](how-to-create-a-custom-token.md)niestandardowy.</span><span class="sxs-lookup"><span data-stu-id="91873-135">For more information about custom security tokens, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2. <span data-ttu-id="91873-136">Utwórz niestandardowego dostawcę tokenów zabezpieczających, który zwraca niestandardowy token zabezpieczający X. 509, jak pokazano w przykładzie.</span><span class="sxs-lookup"><span data-stu-id="91873-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="91873-137">Aby uzyskać więcej informacji o dostawcach niestandardowych tokenów [zabezpieczających, zobacz How to: Utwórz niestandardowego dostawcę](how-to-create-a-custom-security-token-provider.md)tokenów zabezpieczających.</span><span class="sxs-lookup"><span data-stu-id="91873-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3. <span data-ttu-id="91873-138">Jeśli na stronie inicjatora należy użyć niestandardowego klucza zabezpieczeń, należy utworzyć niestandardowe klasy Menedżer tokenów zabezpieczeń klienta i niestandardowe poświadczenia klienta, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="91873-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="91873-139">Aby uzyskać więcej informacji na temat niestandardowych poświadczeń klienta i menedżerów tokenów [zabezpieczających klienta, zobacz Przewodnik: Tworzenie niestandardowych poświadczeń](walkthrough-creating-custom-client-and-service-credentials.md)klienta i usługi.</span><span class="sxs-lookup"><span data-stu-id="91873-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4. <span data-ttu-id="91873-140">Jeśli na stronie adresatów musi być używany niestandardowy klucz zabezpieczeń, Utwórz niestandardowy Menedżer tokenów zabezpieczeń usługi i poświadczenia usługi niestandardowej, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="91873-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="91873-141">Aby uzyskać więcej informacji na temat poświadczeń usługi niestandardowych i menedżerów tokenów [zabezpieczeń usługi, zobacz Przewodnik: Tworzenie niestandardowych poświadczeń](walkthrough-creating-custom-client-and-service-credentials.md)klienta i usługi.</span><span class="sxs-lookup"><span data-stu-id="91873-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="91873-142">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="91873-142">See also</span></span>

- <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.SecurityKey>
- <xref:System.Security.Cryptography.AsymmetricAlgorithm>
- <xref:System.Security.Cryptography.HashAlgorithm>
- <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>
- [<span data-ttu-id="91873-143">Przewodnik: Tworzenie niestandardowych poświadczeń klienta i usługi</span><span class="sxs-lookup"><span data-stu-id="91873-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="91873-144">Instrukcje: Tworzenie niestandardowego wystawcy uwierzytelniania tokenu zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="91873-144">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="91873-145">Instrukcje: Tworzenie niestandardowego dostawcy tokenów zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="91873-145">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="91873-146">Instrukcje: Tworzenie niestandardowego tokenu</span><span class="sxs-lookup"><span data-stu-id="91873-146">How to: Create a Custom Token</span></span>](how-to-create-a-custom-token.md)
